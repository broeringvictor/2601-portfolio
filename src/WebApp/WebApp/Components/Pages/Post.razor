@page "/post/{Slug}"
@using Microsoft.AspNetCore.Components.Web
@using WebApp.Entities
@using WebApp.Services
@inject MarkdownService MarkdownService

@if (_post == null)
{
    <PageTitle>Post não encontrado</PageTitle>
    <div class="mx-auto max-w-3xl px-4 py-16 text-center">
        <h1 class="text-2xl font-bold text-slate-900 dark:text-slate-100">Post não encontrado</h1>
        <p class="mt-4 text-slate-500 dark:text-slate-400">O post que você procura não existe ou foi removido.</p>
        <a href="/blog" class="mt-6 inline-block text-sm font-medium text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">
            &larr; Voltar ao blog
        </a>
    </div>
}
else
{
    <PageTitle>@_post.Title</PageTitle>
    <HeadContent>
        <meta name="description" content="@_post.Excerpt" />
        <meta name="author" content="@_post.Author" />
        <meta property="og:title" content="@_post.Title" />
        <meta property="og:description" content="@_post.Excerpt" />
        <meta property="og:type" content="article" />
        @if (!string.IsNullOrEmpty(_post.OpenGraphImage))
        {
            <meta property="og:image" content="@_post.OpenGraphImage" />
        }
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="@_post.Title" />
        <meta name="twitter:description" content="@_post.Excerpt" />
    </HeadContent>

    <article class="mx-auto max-w-3xl px-4 py-12">
        <a href="/blog" class="mb-8 inline-block text-sm font-medium text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">
            &larr; Voltar ao blog
        </a>

        @if (!string.IsNullOrEmpty(_post.OpenGraphImage))
        {
            <div class="mb-8 overflow-hidden rounded-xl">
                <img src="@_post.OpenGraphImage"
                     alt="@_post.Title"
                     class="h-48 w-full object-cover sm:h-64 lg:h-80"
                     loading="eager" />
            </div>
        }

        <header class="mb-8">
            <h1 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-slate-100 sm:text-4xl">
                @_post.Title
            </h1>
            @if (!string.IsNullOrEmpty(_post.Lead))
            {
                <p class="mt-3 text-lg text-slate-600 dark:text-slate-400">@_post.Lead</p>
            }
            <div class="mt-4 flex items-center gap-3 text-sm text-slate-500 dark:text-slate-400">
                <span>@_post.Author</span>
                <span>&middot;</span>
                <time datetime="@_post.PublishedAt.ToString("yyyy-MM-dd")">
                    @_post.PublishedAt.ToString("dd MMM yyyy")
                </time>
            </div>
            @if (_post.Tags.Count > 0)
            {
                <div class="mt-4 flex flex-wrap gap-2">
                    @foreach (var tag in _post.Tags)
                    {
                        <span class="rounded-full bg-primary-50 px-3 py-1 text-xs font-medium text-primary-700 dark:bg-primary-900/30 dark:text-primary-300">
                            @tag
                        </span>
                    }
                </div>
            }
        </header>

        <div class="prose">
            @((MarkupString)_post.HtmlContent)
        </div>
    </article>
}

@code {
    [Parameter]
    public string Slug { get; set; } = string.Empty;

    private BlogPost? _post;

    protected override async Task OnInitializedAsync()
    {
        _post = await MarkdownService.GetPostBySlugAsync(Slug);
    }
}
