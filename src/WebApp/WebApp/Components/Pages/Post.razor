@page "/post/{Slug}"
@using Microsoft.AspNetCore.Components.Web
@using WebApp.Entities
@using WebApp.Services
@inject MarkdownService MarkdownService
@inject NavigationManager NavigationManager

@if (_post == null)
{
    <PageTitle>Post não encontrado</PageTitle>
    <div class="mx-auto max-w-3xl px-4 py-16 text-center">
        <h1 class="text-2xl font-bold text-slate-900 dark:text-slate-100">Post não encontrado</h1>
        <p class="mt-4 text-slate-500 dark:text-slate-400">O post que você procura não existe ou foi removido.</p>
        <a href="/blog" class="mt-6 inline-block text-sm font-medium text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">
            &larr; Voltar ao blog
        </a>
    </div>
}
else
{
    <PageTitle>@_post.Title</PageTitle>
    <HeadContent>
        <meta name="description" content="@_post.Excerpt" />
        <meta name="author" content="@_post.Author" />
        <link rel="canonical" href="@NavigationManager.Uri" />
        <meta property="og:title" content="@_post.Title" />
        <meta property="og:description" content="@_post.Excerpt" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="@NavigationManager.Uri" />
        <meta property="og:locale" content="pt_BR" />
        <meta property="og:site_name" content="Victor Broering" />
        <meta property="article:published_time" content="@_post.PublishedAt.ToString("yyyy-MM-ddTHH:mm:ssZ")" />
        <meta property="article:author" content="@_post.Author" />
        @if (!string.IsNullOrEmpty(_post.OpenGraphImage))
        {
            <meta property="og:image" content="@_post.OpenGraphImage" />
            <meta name="twitter:image" content="@_post.OpenGraphImage" />
        }
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="@_post.Title" />
        <meta name="twitter:description" content="@_post.Excerpt" />
        <script type="application/ld+json">
        {
            "@@context": "https://schema.org",
            "@@type": "BlogPosting",
            "headline": "@_post.Title",
            "description": "@_post.Excerpt",
            "author": {
                "@@type": "Person",
                "name": "@_post.Author"
            },
            "datePublished": "@_post.PublishedAt.ToString("yyyy-MM-ddTHH:mm:ssZ")",
            "url": "@NavigationManager.Uri",
            "publisher": {
                "@@type": "Person",
                "name": "Victor Broering"
            }@if (!string.IsNullOrEmpty(_post.OpenGraphImage)){@(new MarkupString($",\n            \"image\": \"{_post.OpenGraphImage}\""))}
        }
        </script>
        <script type="application/ld+json">
        {
            "@@context": "https://schema.org",
            "@@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "@NavigationManager.BaseUri"
                },
                {
                    "@@type": "ListItem",
                    "position": 2,
                    "name": "Blog",
                    "item": "@($"{NavigationManager.BaseUri}blog")"
                },
                {
                    "@@type": "ListItem",
                    "position": 3,
                    "name": "@_post.Title",
                    "item": "@NavigationManager.Uri"
                }
            ]
        }
        </script>
    </HeadContent>

    <article class="mx-auto max-w-[75ch] px-4 py-8">
        <a href="/blog" class="mb-6 inline-block text-sm font-medium text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">
            &larr; Voltar ao blog
        </a>

        @if (!string.IsNullOrEmpty(_post.OpenGraphImage))
        {
            <div class="mb-6 overflow-hidden rounded-lg">
                <img src="@_post.OpenGraphImage"
                     alt="@_post.Title"
                     class="h-40 w-full object-cover"
                     loading="eager" />
            </div>
        }

        <header class="mb-6">
            <h1 class="text-xl font-bold tracking-tight text-slate-900 dark:text-slate-100 sm:text-2xl">
                @_post.Title
            </h1>
            @if (!string.IsNullOrEmpty(_post.Lead))
            {
                <p class="mt-2 text-base text-slate-600 dark:text-slate-400">@_post.Lead</p>
            }
            <div class="mt-3 flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                <span>@_post.Author</span>
                <span>&middot;</span>
                <time datetime="@_post.PublishedAt.ToString("yyyy-MM-dd")">
                    @_post.PublishedAt.ToString("dd MMM yyyy")
                </time>
            </div>
            @if (_post.Tags.Count > 0)
            {
                <div class="mt-3 flex flex-wrap gap-1.5">
                    @foreach (var tag in _post.Tags)
                    {
                        <span class="rounded-full bg-primary-50 px-2 py-0.5 text-xs font-medium text-primary-700 dark:bg-primary-900/30 dark:text-primary-300">
                            @tag
                        </span>
                    }
                </div>
            }
        </header>

        <div class="prose">
            @((MarkupString)_post.HtmlContent)
        </div>
    </article>
}

@code {
    [Parameter]
    public string Slug { get; set; } = string.Empty;

    private BlogPost? _post;

    protected override async Task OnInitializedAsync()
    {
        _post = await MarkdownService.GetPostBySlugAsync(Slug);
    }
}
